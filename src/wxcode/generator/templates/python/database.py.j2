"""MongoDB database connection.

Generated by wxcode from {{ project_name }}.
"""

from motor.motor_asyncio import AsyncIOMotorClient, AsyncIOMotorDatabase

from .config import settings

# Global database client and database
_client: AsyncIOMotorClient | None = None
_db: AsyncIOMotorDatabase | None = None


async def init_db() -> None:
    """Initialize database connection."""
    global _client, _db
    _client = AsyncIOMotorClient(settings.mongodb_url)
    _db = _client[settings.mongodb_database]


async def close_db() -> None:
    """Close database connection."""
    global _client, _db
    if _client:
        _client.close()
        _client = None
        _db = None


def get_db() -> AsyncIOMotorDatabase:
    """Get database instance for dependency injection.

    Usage in routes:
        @router.get("/items")
        async def get_items(db: AsyncIOMotorDatabase = Depends(get_db)):
            ...
    """
    if _db is None:
        raise RuntimeError("Database not initialized. Call init_db() first.")
    return _db
