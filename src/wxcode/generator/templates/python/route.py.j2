"""Routes for {{ route_name }}.

Generated by wxcode from WinDev page.
Original page: {{ original_page }}
"""

from fastapi import APIRouter, Depends, Request
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates

{% for import_line in imports %}
{{ import_line }}
{% endfor %}

router = APIRouter()
templates = Jinja2Templates(directory="app/templates")


{% for route in routes %}
@router.{{ route.method | lower }}("{{ route.path }}"{% if route.response_class %}, response_class={{ route.response_class }}{% endif %}{% if route.status_code %}, status_code={{ route.status_code }}{% endif %})
async def {{ route.handler_name }}(
    request: Request,
    {% for param in route.path_params %}
    {{ param.name }}: {{ param.type }},
    {% endfor %}
    {% for param in route.query_params %}
    {{ param.name }}: {{ param.type }}{% if param.default is not none %} = {{ param.default }}{% endif %},
    {% endfor %}
    {% for dep in route.dependencies %}
    {{ dep.name }}: {{ dep.type }} = Depends({{ dep.factory }}),
    {% endfor %}
){% if route.return_type %} -> {{ route.return_type }}{% endif %}:
    """{{ route.docstring or 'Route generated from ' + original_page }}."""
    {% if route.body %}
    {{ route.body | indent(4) }}
    {% else %}
    return templates.TemplateResponse(
        "{{ route.template_path }}",
        {"request": request}
    )
    {% endif %}

{% endfor %}
