---
phase: 03-page-integration
plan: 01
type: execute
wave: 1
depends_on: ["02-02"]
files_modified:
  - frontend/src/app/project/[id]/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Delete button is visible in project header"
    - "Clicking delete button opens confirmation modal"
    - "After successful deletion, user is redirected to /dashboard"
    - "Project list is refreshed after deletion (no stale cache)"
  artifacts:
    - path: "frontend/src/app/project/[id]/layout.tsx"
      provides: "Delete button and modal integration"
      contains: "DeleteProjectModal"
  key_links:
    - from: "frontend/src/app/project/[id]/layout.tsx"
      to: "DeleteProjectModal"
      via: "import from @/components/project"
      pattern: "import.*DeleteProjectModal"
    - from: "layout.tsx headerActions"
      to: "setIsDeleteOpen"
      via: "onClick handler"
      pattern: "onClick.*setIsDeleteOpen.*true"
    - from: "DeleteProjectModal onDeleted"
      to: "router.push"
      via: "callback navigation"
      pattern: 'router\\.push.*dashboard'
---

<objective>
Wire DeleteProjectModal into project layout with delete button in header and post-deletion navigation.

Purpose: Complete the delete project feature by connecting the modal (from Phase 2) to the project page, enabling users to safely delete projects with proper navigation afterward.

Output: Updated layout.tsx with functional delete button and modal integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-page-integration/03-RESEARCH.md
@.planning/phases/02-ui-components/02-02-SUMMARY.md
@frontend/src/app/project/[id]/layout.tsx
@frontend/src/components/project/DeleteProjectModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire delete button and modal into project layout</name>
  <files>frontend/src/app/project/[id]/layout.tsx</files>
  <action>
Update the project layout to integrate delete functionality:

1. **Add imports:**
   - `useState` from "react" (add to existing import)
   - `useRouter` from "next/navigation"
   - `Trash2` from "lucide-react" (add to existing lucide import)
   - `DeleteProjectModal` from "@/components/project"
   - `Button` from "@/components/ui/button"

2. **Add state and router inside component:**
   ```typescript
   const router = useRouter();
   const [isDeleteOpen, setIsDeleteOpen] = useState(false);
   ```

3. **Create handleDeleted callback:**
   ```typescript
   const handleDeleted = () => {
     router.push("/dashboard");
   };
   ```

4. **Add headerActions prop to WorkspaceLayout:**
   ```typescript
   headerActions={
     <Button
       variant="ghost"
       size="sm"
       onClick={() => setIsDeleteOpen(true)}
       className="text-zinc-400 hover:text-rose-400 hover:bg-rose-500/10"
     >
       <Trash2 className="w-4 h-4" />
       <span className="sr-only">Excluir projeto</span>
     </Button>
   }
   ```

5. **Render DeleteProjectModal after children inside WorkspaceLayout:**
   ```typescript
   <DeleteProjectModal
     projectId={projectId}
     projectName={project?.name || ""}
     isOpen={isDeleteOpen}
     onClose={() => setIsDeleteOpen(false)}
     onDeleted={handleDeleted}
   />
   ```

**Note:** The modal goes INSIDE WorkspaceLayout as a sibling to {children}, not outside. This ensures proper portal rendering with the layout's context.

**Skip stats prop for now** - it's optional and would require an additional API call. Can be added in future enhancement.
  </action>
  <verify>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit` - no errors
2. Dev server runs: `npm run dev` starts without errors
3. Visual check: Navigate to any project page, verify Trash2 icon appears in header
4. Functional check: Click trash icon, modal opens with project name in confirmation prompt
  </verify>
  <done>
- Delete button (Trash2 icon) visible in project header
- Clicking button opens DeleteProjectModal
- Modal shows correct project name
- Typing project name enables delete button
- After deletion, redirects to /dashboard
- Project list on dashboard is fresh (deleted project not shown)
  </done>
</task>

</tasks>

<verification>
**TypeScript:**
```bash
cd frontend && npx tsc --noEmit
```

**Build check:**
```bash
cd frontend && npm run build
```

**Manual verification checklist:**
1. [ ] Start dev server: `npm run dev`
2. [ ] Navigate to project page (e.g., /project/Linkpay_ADM)
3. [ ] Verify delete button (trash icon) appears in header
4. [ ] Click delete button - modal should open
5. [ ] Modal shows "Digite Linkpay_ADM para confirmar"
6. [ ] Type wrong name - delete button stays disabled
7. [ ] Type correct name - delete button enables
8. [ ] Click delete - shows "Excluindo..." loading state
9. [ ] After deletion - redirects to /dashboard
10. [ ] Deleted project does not appear in project list
</verification>

<success_criteria>
1. TypeScript compiles without errors
2. Build succeeds
3. Delete button visible in project header (ghost style, muted color)
4. Modal opens on click with correct project name
5. Type-to-confirm works (case-sensitive)
6. Post-deletion redirects to /dashboard
7. Project list refreshes automatically (cache invalidation works)
</success_criteria>

<output>
After completion, create `.planning/phases/03-page-integration/03-01-SUMMARY.md`
</output>
