---
phase: 02-ui-components
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/components/project/DeleteProjectModal.tsx
  - frontend/src/components/project/index.ts
autonomous: true

must_haves:
  truths:
    - "Modal displays explicit warning about deletion consequences (MongoDB, Neo4j, files)"
    - "Modal shows resource counts that will be deleted from stats prop"
    - "Delete button is disabled until user types exact project name (case-sensitive)"
    - "During deletion, loading state shows and all interactions are disabled"
    - "On error, modal stays open with error message visible"
  artifacts:
    - path: "frontend/src/components/project/DeleteProjectModal.tsx"
      provides: "Delete confirmation modal component"
      exports: ["DeleteProjectModal", "DeleteProjectModalProps"]
      min_lines: 100
  key_links:
    - from: "frontend/src/components/project/DeleteProjectModal.tsx"
      to: "@radix-ui/react-alert-dialog"
      via: "AlertDialog component import"
      pattern: "import.*AlertDialog.*from.*@radix-ui/react-alert-dialog"
    - from: "frontend/src/components/project/DeleteProjectModal.tsx"
      to: "frontend/src/hooks/useDeleteProject.ts"
      via: "useDeleteProject hook import"
      pattern: "useDeleteProject"
---

<objective>
Create the DeleteProjectModal component with type-to-confirm pattern

Purpose: Build the confirmation modal that users interact with to delete a project. This is the critical UI component that ensures safe deletion through explicit confirmation.

Output: DeleteProjectModal.tsx component that displays warnings, requires typing project name, handles loading/error states, and integrates with useDeleteProject hook.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ui-components/02-RESEARCH.md
@.planning/phases/02-ui-components/02-CONTEXT.md

# Prior plan context (hook and types)
@.planning/phases/02-ui-components/02-01-SUMMARY.md

# Existing patterns to follow
@frontend/src/components/project/CreateConversionModal.tsx
@frontend/src/components/ui/button.tsx
@frontend/src/lib/animations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DeleteProjectModal component</name>
  <files>frontend/src/components/project/DeleteProjectModal.tsx</files>
  <action>
    Create the DeleteProjectModal component using Radix AlertDialog.

    **Props interface:**
    ```typescript
    export interface DeleteProjectModalProps {
      projectId: string;
      projectName: string;
      isOpen: boolean;
      onClose: () => void;
      onDeleted?: () => void;  // Called after successful deletion
      stats?: {
        elements: number;
        controls: number;
        procedures: number;
        conversions: number;
      };
    }
    ```

    **Key implementation details:**

    1. **Radix AlertDialog structure:**
       - Use AlertDialog.Root with controlled open state
       - AlertDialog.Portal for rendering in portal
       - AlertDialog.Overlay with backdrop styling (bg-black/60 backdrop-blur-sm)
       - AlertDialog.Content centered with zinc-900 background

    2. **Warning content:**
       - AlertDialog.Title: "Excluir Projeto"
       - AlertDialog.Description: Explicit warning about what will be deleted
       - Show stats if provided (elements, controls, procedures, conversions counts)

    3. **Type-to-confirm input:**
       - Local state: `const [confirmText, setConfirmText] = useState("")`
       - Reset confirmText when modal opens/closes via onOpenChange
       - Placeholder: "Digite o nome do projeto para confirmar"
       - Use existing input styling from codebase (see GlowInput or CreateConversionModal)

    4. **Delete button logic:**
       - Disabled when: `isPending || confirmText !== projectName`
       - Note: EXACT match, case-sensitive
       - Use Button component with variant="destructive"
       - Text: isPending ? "Excluindo..." : "Excluir Projeto"

    5. **Prevent auto-close on Action:**
       - On AlertDialog.Action onClick: call e.preventDefault() first
       - Then call mutate(projectId, { onSuccess, onError })
       - onSuccess: call onClose(), then onDeleted?.()
       - onError: do nothing (error shown in modal via hook's error state)

    6. **Error display:**
       - If mutation.error, show error message below the input
       - Use rose-400 text color for error
       - Clear error when user starts typing again (optional, but recommended)

    7. **Cancel button:**
       - Use AlertDialog.Cancel
       - Disabled when isPending
       - Text: "Cancelar"

    **Styling to follow (from CreateConversionModal):**
    - Modal container: bg-zinc-900 border border-zinc-800 rounded-lg shadow-2xl
    - Heading: text-xl font-semibold text-zinc-100
    - Subtext: text-sm text-zinc-400
    - Danger text: text-rose-400 for warnings
    - Use framer-motion for entry/exit animations (optional but matches codebase)

    **Full component structure:**
    ```tsx
    "use client";

    import { useState } from "react";
    import * as AlertDialog from "@radix-ui/react-alert-dialog";
    import { AlertTriangle } from "lucide-react";
    import { Button } from "@/components/ui/button";
    import { cn } from "@/lib/utils";
    import { useDeleteProject } from "@/hooks";

    export interface DeleteProjectModalProps {
      projectId: string;
      projectName: string;
      isOpen: boolean;
      onClose: () => void;
      onDeleted?: () => void;
      stats?: {
        elements: number;
        controls: number;
        procedures: number;
        conversions: number;
      };
    }

    export function DeleteProjectModal({
      projectId,
      projectName,
      isOpen,
      onClose,
      onDeleted,
      stats,
    }: DeleteProjectModalProps) {
      const [confirmText, setConfirmText] = useState("");
      const { mutate, isPending, error, reset } = useDeleteProject();

      const handleOpenChange = (open: boolean) => {
        if (!open && !isPending) {
          setConfirmText("");
          reset();
          onClose();
        }
      };

      const handleDelete = (e: React.MouseEvent) => {
        e.preventDefault();
        mutate(projectId, {
          onSuccess: () => {
            onClose();
            onDeleted?.();
          },
        });
      };

      const isConfirmValid = confirmText === projectName;

      return (
        <AlertDialog.Root open={isOpen} onOpenChange={handleOpenChange}>
          <AlertDialog.Portal>
            <AlertDialog.Overlay className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50" />
            <AlertDialog.Content className="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md mx-4">
              <div className="bg-zinc-900 border border-zinc-800 rounded-lg shadow-2xl p-6">
                {/* Header with warning icon */}
                <div className="flex items-start gap-4 mb-4">
                  <div className="p-2 bg-rose-500/10 rounded-lg">
                    <AlertTriangle className="w-6 h-6 text-rose-500" />
                  </div>
                  <div>
                    <AlertDialog.Title className="text-xl font-semibold text-zinc-100">
                      Excluir Projeto
                    </AlertDialog.Title>
                    <AlertDialog.Description className="text-sm text-zinc-400 mt-1">
                      Esta acao nao pode ser desfeita.
                    </AlertDialog.Description>
                  </div>
                </div>

                {/* Warning content */}
                <div className="bg-rose-500/5 border border-rose-500/20 rounded-lg p-4 mb-4">
                  <p className="text-sm text-zinc-300 mb-2">
                    Isso ira excluir permanentemente:
                  </p>
                  <ul className="text-sm text-zinc-400 space-y-1 list-disc list-inside">
                    <li>Todos os dados do MongoDB {stats && `(${stats.elements} elementos, ${stats.controls} controles)`}</li>
                    <li>Dados do Neo4j (grafo de dependencias)</li>
                    <li>Arquivos locais do projeto</li>
                  </ul>
                </div>

                {/* Confirm input */}
                <div className="mb-4">
                  <label className="block text-sm font-medium text-zinc-300 mb-2">
                    Digite <span className="font-mono text-rose-400">{projectName}</span> para confirmar:
                  </label>
                  <input
                    type="text"
                    value={confirmText}
                    onChange={(e) => setConfirmText(e.target.value)}
                    disabled={isPending}
                    placeholder="Nome do projeto"
                    className={cn(
                      "w-full rounded-lg px-4 py-2.5",
                      "border outline-none transition-all duration-200",
                      "bg-zinc-800 border-zinc-700 text-sm text-zinc-100",
                      "hover:border-zinc-600",
                      "focus:border-rose-500 focus:ring-1 focus:ring-rose-500/20",
                      "placeholder:text-zinc-500",
                      "disabled:opacity-50 disabled:cursor-not-allowed"
                    )}
                  />
                </div>

                {/* Error message */}
                {error && (
                  <p className="text-sm text-rose-400 mb-4">
                    {error.message}
                  </p>
                )}

                {/* Actions */}
                <div className="flex justify-end gap-3">
                  <AlertDialog.Cancel asChild>
                    <Button variant="outline" disabled={isPending}>
                      Cancelar
                    </Button>
                  </AlertDialog.Cancel>
                  <AlertDialog.Action asChild>
                    <Button
                      variant="destructive"
                      disabled={isPending || !isConfirmValid}
                      onClick={handleDelete}
                    >
                      {isPending ? "Excluindo..." : "Excluir Projeto"}
                    </Button>
                  </AlertDialog.Action>
                </div>
              </div>
            </AlertDialog.Content>
          </AlertDialog.Portal>
        </AlertDialog.Root>
      );
    }
    ```

    **Note on AlertDialog.Action behavior:**
    - AlertDialog.Action normally closes the modal on click
    - We use e.preventDefault() to stop this and handle closing manually on success
    - This ensures user sees loading state and error messages if deletion fails
  </action>
  <verify>
    Run: `head -80 frontend/src/components/project/DeleteProjectModal.tsx`
    Expected: Shows component with AlertDialog, confirmText state, delete button logic
  </verify>
  <done>DeleteProjectModal component exists with all requirements: Radix AlertDialog, warning content, type-to-confirm input, disabled state until match, loading state, error display</done>
</task>

<task type="auto">
  <name>Task 2: Export DeleteProjectModal from index</name>
  <files>frontend/src/components/project/index.ts</files>
  <action>
    Add export for DeleteProjectModal to the component index file.

    Add this line to frontend/src/components/project/index.ts:
    ```typescript
    export { DeleteProjectModal, type DeleteProjectModalProps } from "./DeleteProjectModal";
    ```

    Place it alphabetically or logically near other modal exports (CreateConversionModal).
  </action>
  <verify>
    Run: `grep "DeleteProjectModal" frontend/src/components/project/index.ts`
    Expected: Shows the export line
  </verify>
  <done>DeleteProjectModal exported from frontend/src/components/project/index.ts</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Component exists: `ls frontend/src/components/project/DeleteProjectModal.tsx`
2. TypeScript compiles: `cd frontend && npx tsc --noEmit src/components/project/DeleteProjectModal.tsx` (or full check)
3. Exports correct: `grep -E "(DeleteProjectModal|DeleteProjectModalProps)" frontend/src/components/project/index.ts`
4. Required patterns present:
   - AlertDialog import: `grep "AlertDialog" frontend/src/components/project/DeleteProjectModal.tsx`
   - useDeleteProject: `grep "useDeleteProject" frontend/src/components/project/DeleteProjectModal.tsx`
   - confirmText state: `grep "confirmText" frontend/src/components/project/DeleteProjectModal.tsx`
   - isPending check: `grep "isPending" frontend/src/components/project/DeleteProjectModal.tsx`
</verification>

<success_criteria>
- DeleteProjectModal component created with Radix AlertDialog
- Modal displays warning about what will be deleted
- Shows resource counts from stats prop
- Delete button disabled until exact project name typed (case-sensitive)
- Loading state shown during deletion with all interactions disabled
- Error message displayed in modal without closing
- Component exported from index.ts
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-components/02-02-SUMMARY.md`
</output>
