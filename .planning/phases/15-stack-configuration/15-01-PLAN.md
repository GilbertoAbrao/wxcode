---
phase: 15-stack-configuration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/wxcode/data/stacks/__init__.py
  - src/wxcode/data/stacks/server-rendered/fastapi-jinja2.yaml
  - src/wxcode/data/stacks/server-rendered/fastapi-htmx.yaml
  - src/wxcode/data/stacks/server-rendered/django-templates.yaml
  - src/wxcode/data/stacks/server-rendered/laravel-blade.yaml
  - src/wxcode/data/stacks/server-rendered/rails-erb.yaml
autonomous: true

must_haves:
  truths:
    - "5 server-rendered stack configs exist as YAML files"
    - "Each YAML has all required fields (stack_id, name, group, language, framework, orm, etc.)"
    - "Type mappings include all 28 HyperFile type codes"
    - "File structure and naming conventions are complete"
  artifacts:
    - path: "src/wxcode/data/stacks/server-rendered/fastapi-jinja2.yaml"
      provides: "FastAPI + Jinja2 stack config"
      contains: "stack_id: fastapi-jinja2"
    - path: "src/wxcode/data/stacks/server-rendered/django-templates.yaml"
      provides: "Django + Templates stack config"
      contains: "stack_id: django-templates"
    - path: "src/wxcode/data/stacks/server-rendered/laravel-blade.yaml"
      provides: "Laravel + Blade stack config"
      contains: "stack_id: laravel-blade"
    - path: "src/wxcode/data/stacks/server-rendered/rails-erb.yaml"
      provides: "Rails + ERB stack config"
      contains: "stack_id: rails-erb"
  key_links:
    - from: "src/wxcode/data/stacks/__init__.py"
      to: "server-rendered/*.yaml"
      via: "package marker"
      pattern: "empty file or docstring"
---

<objective>
Create YAML configuration files for the 5 server-rendered target stacks.

Purpose: These stack configs provide metadata for LLM-driven code generation. Each YAML file defines the stack's characteristics (ORM pattern, naming conventions, file structure, type mappings) that Claude Code uses to generate idiomatic code.

Output: 5 YAML files in src/wxcode/data/stacks/server-rendered/ plus package __init__.py
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/15-stack-configuration/15-RESEARCH.md
@src/wxcode/models/stack.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create data/stacks directory structure</name>
  <files>
    src/wxcode/data/__init__.py
    src/wxcode/data/stacks/__init__.py
    src/wxcode/data/stacks/server-rendered/.gitkeep
  </files>
  <action>
Create the data/stacks directory structure:

1. Create `src/wxcode/data/__init__.py` with a simple docstring:
   ```python
   """Data files for wxcode."""
   ```

2. Create `src/wxcode/data/stacks/__init__.py` with:
   ```python
   """
   Stack configuration YAML files.

   Organized by group: server-rendered/, spa/, fullstack/
   """
   ```

3. Create empty directories (or .gitkeep) for:
   - src/wxcode/data/stacks/server-rendered/
   - src/wxcode/data/stacks/spa/
   - src/wxcode/data/stacks/fullstack/
  </action>
  <verify>
    ls -la src/wxcode/data/stacks/
    # Should show __init__.py and three subdirectories
  </verify>
  <done>Directory structure exists with __init__.py files</done>
</task>

<task type="auto">
  <name>Task 2: Create server-rendered stack YAML files</name>
  <files>
    src/wxcode/data/stacks/server-rendered/fastapi-jinja2.yaml
    src/wxcode/data/stacks/server-rendered/fastapi-htmx.yaml
    src/wxcode/data/stacks/server-rendered/django-templates.yaml
    src/wxcode/data/stacks/server-rendered/laravel-blade.yaml
    src/wxcode/data/stacks/server-rendered/rails-erb.yaml
  </files>
  <action>
Create 5 YAML files with COMPLETE stack configurations. Each file must include ALL fields from the Stack model:

**Required fields for each YAML:**
- stack_id: unique identifier (e.g., "fastapi-jinja2")
- name: display name (e.g., "FastAPI + Jinja2")
- group: "server-rendered"
- language: "python" | "php" | "ruby"
- framework: "fastapi" | "django" | "laravel" | "rails"
- orm: "sqlalchemy" | "django-orm" | "eloquent" | "active-record"
- orm_pattern: "data-mapper" | "active-record"
- template_engine: "jinja2" | "django" | "blade" | "erb"
- file_structure: dict with paths for models, schemas, routes, services, templates, static
- naming_conventions: dict with class, file, variable, constant, database_table
- type_mappings: dict mapping HyperFile type codes (1-28) to target types
- imports_template: multiline string with common imports
- model_template: multiline string with example model structure

**Stack details:**

1. **fastapi-jinja2.yaml**:
   - language: python, orm: sqlalchemy, orm_pattern: data-mapper
   - file_structure: app/models/, app/schemas/, app/routes/, app/services/, app/templates/, app/static/
   - Type mappings: 1->bytes, 2->str, 4->int, 7->int, 8->float, 10->datetime, 13->bool, 14->Decimal, 23->dict, 26->UUID

2. **fastapi-htmx.yaml**:
   - Same as fastapi-jinja2 but with htmx-specific template patterns
   - template_engine: jinja2 (HTMX uses Jinja2 with HTMX attributes)

3. **django-templates.yaml**:
   - language: python, orm: django-orm, orm_pattern: active-record
   - file_structure: app/models.py, app/views.py, app/urls.py, app/templates/
   - Type mappings: Use Django field types (CharField, IntegerField, etc.)

4. **laravel-blade.yaml**:
   - language: php, orm: eloquent, orm_pattern: active-record
   - file_structure: app/Models/, app/Http/Controllers/, resources/views/
   - Type mappings: PHP types (string, int, float, bool, array)

5. **rails-erb.yaml**:
   - language: ruby, orm: active-record, orm_pattern: active-record
   - file_structure: app/models/, app/controllers/, app/views/
   - Type mappings: Ruby/Rails types (String, Integer, Float, Boolean)

**IMPORTANT:** Include ALL 28 HyperFile type codes in type_mappings. Use the research document for reference. Unknown/exotic types should map to sensible defaults (e.g., string).
  </action>
  <verify>
    # Check all files exist
    ls src/wxcode/data/stacks/server-rendered/*.yaml | wc -l
    # Should output 5

    # Verify YAML validity
    python -c "import yaml; [yaml.safe_load(open(f)) for f in __import__('glob').glob('src/wxcode/data/stacks/server-rendered/*.yaml')]"
    # Should complete without errors
  </verify>
  <done>5 server-rendered stack YAML files created with complete metadata</done>
</task>

</tasks>

<verification>
1. Directory structure exists: `ls -la src/wxcode/data/stacks/`
2. All 5 YAML files exist: `ls src/wxcode/data/stacks/server-rendered/*.yaml`
3. YAML files are valid: `python -c "import yaml; ..."`
4. Each YAML has required fields: spot check stack_id, type_mappings, file_structure
</verification>

<success_criteria>
- 5 YAML files in src/wxcode/data/stacks/server-rendered/
- Each file has all required Stack model fields
- Type mappings include all 28 HyperFile codes
- YAML files parse without errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-stack-configuration/15-01-SUMMARY.md`
</output>
