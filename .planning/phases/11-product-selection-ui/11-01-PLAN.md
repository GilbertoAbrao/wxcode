---
phase: 11-product-selection-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/product.ts
  - frontend/src/hooks/useProducts.ts
  - frontend/src/app/import/page.tsx
autonomous: true

must_haves:
  truths:
    - "Product types match backend API contract"
    - "useProducts hook fetches products by project_id"
    - "Import completion redirects to /project/{name}/factory"
  artifacts:
    - path: "frontend/src/types/product.ts"
      provides: "ProductType, ProductStatus, Product interface"
      exports: ["ProductType", "ProductStatus", "Product", "ProductResponse", "ProductListResponse"]
    - path: "frontend/src/hooks/useProducts.ts"
      provides: "Products data fetching"
      exports: ["useProducts", "useCreateProduct"]
    - path: "frontend/src/app/import/page.tsx"
      provides: "Factory redirect after import"
      contains: "router.push(`/project/${projectName}/factory`)"
  key_links:
    - from: "frontend/src/hooks/useProducts.ts"
      to: "/api/products"
      via: "fetch call"
      pattern: "fetch.*api/products"
    - from: "frontend/src/app/import/page.tsx"
      to: "/project/{name}/factory"
      via: "router.push"
      pattern: "router\\.push.*factory"
---

<objective>
Create the foundation for Product Selection UI: TypeScript types, data fetching hook, and import redirect.

Purpose: Enable the factory page (Plan 03) to fetch and display products with proper typing.
Output: Product types, useProducts hook, and updated import flow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-product-selection-ui/11-RESEARCH.md

# Backend API contract
@src/wxcode/models/product.py
@src/wxcode/api/products.py

# Existing patterns
@frontend/src/types/project.ts
@frontend/src/hooks/useProject.ts
@frontend/src/app/import/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Product TypeScript types</name>
  <files>frontend/src/types/product.ts</files>
  <action>
Create `frontend/src/types/product.ts` with:

1. ProductType enum matching backend:
   - "conversion" | "api" | "mcp" | "agents"

2. ProductStatus enum matching backend:
   - "pending" | "in_progress" | "paused" | "completed" | "failed" | "unavailable"

3. Product interface matching backend ProductResponse:
   - id: string
   - project_id: string
   - project_name: string
   - product_type: ProductType
   - status: ProductStatus
   - workspace_path: string
   - session_id: string | null
   - output_directory: string | null
   - created_at: string (ISO date)
   - updated_at: string (ISO date)

4. ProductListResponse interface:
   - products: Product[]
   - total: number

5. CreateProductRequest interface:
   - project_id: string
   - product_type: ProductType

6. AVAILABLE_PRODUCT_TYPES constant:
   - Array containing only "conversion" (to match backend)

7. Product card configuration object (for UI display):
   - productTypeConfig: Record<ProductType, { title: string; description: string; icon: string }>
   - Titles in Portuguese: "Conversao FastAPI", "API REST", "Servidor MCP", "Agentes IA"
   - Descriptions explaining what each product does

Follow the pattern from `frontend/src/types/project.ts` for status configs.
  </action>
  <verify>
    - File exists at frontend/src/types/product.ts
    - TypeScript compiles without errors: `cd frontend && npx tsc --noEmit 2>&1 | head -20`
  </verify>
  <done>Product types defined and type-safe</done>
</task>

<task type="auto">
  <name>Task 2: Create useProducts hook</name>
  <files>frontend/src/hooks/useProducts.ts</files>
  <action>
Create `frontend/src/hooks/useProducts.ts` following the pattern from `useProject.ts`:

1. Import TanStack Query hooks (useQuery, useMutation, useQueryClient)
2. Import Product types from "@/types/product"

3. Create fetchProducts function:
   - Takes projectId: string parameter
   - Calls GET /api/products?project_id={projectId}
   - Returns ProductListResponse

4. Create createProduct function:
   - Takes CreateProductRequest
   - Calls POST /api/products with JSON body
   - Returns Product

5. Export useProducts hook:
   - Takes projectId: string
   - Returns useQuery with queryKey ["products", projectId]
   - Enabled only when projectId is truthy

6. Export useCreateProduct hook:
   - Returns useMutation that calls createProduct
   - On success: invalidates ["products", projectId] query

Do NOT use mock data pattern - the backend is ready.
Use relative fetch URLs (/api/products) which Next.js proxies to backend.
  </action>
  <verify>
    - File exists at frontend/src/hooks/useProducts.ts
    - TypeScript compiles: `cd frontend && npx tsc --noEmit 2>&1 | head -20`
  </verify>
  <done>useProducts and useCreateProduct hooks ready for use</done>
</task>

<task type="auto">
  <name>Task 3: Update import redirect to factory page</name>
  <files>frontend/src/app/import/page.tsx</files>
  <action>
Modify `frontend/src/app/import/page.tsx`:

1. Find the handleContinue function (line ~64-68)

2. Change the redirect from:
   `router.push(`/project/${projectName}`)`
   To:
   `router.push(`/project/${projectName}/factory`)`

This is a single-line change. The factory page will be created in Plan 03.

Do NOT change anything else in the file.
  </action>
  <verify>
    - grep -n "router.push.*factory" frontend/src/app/import/page.tsx shows the change with line number
    - Full redirect path is `/project/${projectName}/factory` (not just contains "factory")
  </verify>
  <done>Import completion redirects to product factory page</done>
</task>

</tasks>

<verification>
- All three files exist and contain expected content
- TypeScript compilation passes: `cd frontend && npx tsc --noEmit`
- Import redirect points to factory: grep "router.push.*factory" frontend/src/app/import/page.tsx
</verification>

<success_criteria>
- Product types match backend API exactly (ProductType, ProductStatus, Product)
- useProducts hook queries /api/products with project_id filter
- useCreateProduct hook posts to /api/products
- Import wizard redirects to /project/{name}/factory on completion
</success_criteria>

<output>
After completion, create `.planning/phases/11-product-selection-ui/11-01-SUMMARY.md`
</output>
