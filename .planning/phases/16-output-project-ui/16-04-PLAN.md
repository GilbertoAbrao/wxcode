---
phase: 16-output-project-ui
plan: 04
type: execute
wave: 4
depends_on: ["16-03"]
files_modified:
  - frontend/src/app/project/[id]/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can click 'Create Project' button on KB detail page"
    - "CreateProjectModal opens with KB context"
    - "User can complete full creation flow"
    - "Created output project appears (or redirects)"
  artifacts:
    - path: "frontend/src/app/project/[id]/page.tsx"
      provides: "KB detail page with Create Project button"
      contains: "CreateProjectModal"
  key_links:
    - from: "frontend/src/app/project/[id]/page.tsx"
      to: "CreateProjectModal"
      via: "component import and render"
      pattern: "import.*CreateProjectModal"
---

<objective>
Integrate CreateProjectModal into the KB detail page and verify the complete end-to-end flow.

Purpose: Wire up the modal to the existing project detail page, enabling users to create output projects. This completes the Phase 16 deliverable.

Output: Working creation flow accessible from KB detail page, verified through manual testing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/16-output-project-ui/16-RESEARCH.md
@.planning/phases/16-output-project-ui/16-03-SUMMARY.md

# Integration target
@frontend/src/app/project/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate CreateProjectModal into KB detail page</name>
  <files>frontend/src/app/project/[id]/page.tsx</files>
  <action>
Add CreateProjectModal to the project detail page.

Changes to frontend/src/app/project/[id]/page.tsx:

1. Add imports:
```typescript
import { useState } from "react";
import { CreateProjectModal } from "@/components/output-project";
import { Plus } from "lucide-react";
```

2. Add state for modal:
```typescript
const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);
```

3. Add "Create Project" button in the header section (near other action buttons):
```typescript
<Button
  onClick={() => setIsCreateModalOpen(true)}
  className="gap-2"
>
  <Plus className="w-4 h-4" />
  Create Project
</Button>
```

4. Add modal at end of component (before closing fragment/div):
```typescript
<CreateProjectModal
  kbId={project.id}
  kbName={project.display_name || project.name}
  configurations={project.configurations || []}
  isOpen={isCreateModalOpen}
  onClose={() => setIsCreateModalOpen(false)}
  onCreated={(newProject) => {
    // Could redirect to new project or show toast
    console.log("Created:", newProject);
    setIsCreateModalOpen(false);
  }}
/>
```

Note: The project object should already have configurations from the API response. If not available, pass empty array.

Place the button logically - either:
- In header alongside existing buttons
- In a new "Actions" section
- As a prominent CTA if this is the main action

Use the existing Button component from @/components/ui/button.
  </action>
  <verify>
```bash
cd /Users/gilberto/projetos/wxk/wxcode/frontend

# Type check
npx tsc --noEmit src/app/project/\\[id\\]/page.tsx 2>&1 | tail -20 || echo "Type check done"

# Verify imports
grep -E "CreateProjectModal|isCreateModalOpen" src/app/project/\\[id\\]/page.tsx
```
  </verify>
  <done>
- page.tsx imports CreateProjectModal
- State for modal open/close
- Button to trigger modal
- Modal receives correct props (kbId, kbName, configurations)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete output project creation flow:
- Backend API: GET /api/stacks/grouped, POST /api/output-projects
- Frontend: StackSelector, ConfigurationSelector, CreateProjectModal
- Integration: Create Project button on KB detail page
  </what-built>
  <how-to-verify>
1. Start backend: `cd /Users/gilberto/projetos/wxk/wxcode && uvicorn wxcode.main:app --reload`
2. Start frontend: `cd frontend && npm run dev`
3. Open http://localhost:3052 in browser
4. Navigate to any KB (project) detail page
5. Click "Create Project" button
6. Verify modal opens with:
   - Name input field
   - Stacks grouped in 3 categories (Server-rendered, SPA, Fullstack)
   - Configuration dropdown (may be empty if no configurations)
7. Enter a project name (e.g., "Test FastAPI Project")
8. Select a stack (e.g., "FastAPI + Jinja2")
9. Click "Create Project" button
10. Verify:
    - No errors in browser console
    - Modal closes on success
    - Check backend logs for output project creation

Expected result: OutputProject created with workspace at ~/.wxcode/workspaces/
  </how-to-verify>
  <resume-signal>Type "approved" if flow works, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Manual verification via checkpoint task above.

Backend verification:
```bash
cd /Users/gilberto/projetos/wxk/wxcode

# Verify stacks endpoint returns data
curl -s http://localhost:8000/api/stacks/grouped | python -c "
import sys, json
d = json.load(sys.stdin)
print(f'Server-rendered: {len(d[\"server_rendered\"])} stacks')
print(f'SPA: {len(d[\"spa\"])} stacks')
print(f'Fullstack: {len(d[\"fullstack\"])} stacks')
"

# Verify output projects endpoint works
curl -s http://localhost:8000/api/output-projects | python -c "
import sys, json
d = json.load(sys.stdin)
print(f'Total output projects: {d[\"total\"]}')
"
```
</verification>

<success_criteria>
- Create Project button visible on KB detail page
- Modal opens with stack selector showing 15 stacks in 3 groups
- User can select stack and enter name
- Create button creates OutputProject via API
- Workspace created at ~/.wxcode/workspaces/
- No errors in browser console or backend logs
</success_criteria>

<output>
After completion, create `.planning/phases/16-output-project-ui/16-04-SUMMARY.md`
</output>
