---
phase: 30-ui-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Breadcrumb shows KB > Output Project > Milestone hierarchy clearly"
    - "Initialize Project page shows interactive terminal immediately when session exists"
    - "Page refresh on milestone shows terminal with active session"
    - "Milestone page does not show redundant INICIAR button"
  artifacts:
    - path: "frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx"
      provides: "Enhanced breadcrumbs, terminal session rendering, INICIAR button removed"
      contains: ["useTerminalSessionOptional", "breadcrumbs"]
  key_links:
    - from: "frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx"
      to: "TerminalSessionContext"
      via: "useTerminalSessionOptional hook"
      pattern: "useTerminalSessionOptional"
    - from: "frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx"
      to: "InteractiveTerminal"
      via: "conditional rendering based on session state"
      pattern: "InteractiveTerminal.*milestoneId"
---

<objective>
Update Output Project page with enhanced breadcrumbs, intelligent terminal rendering, and remove redundant INICIAR button.

Purpose: Improve navigation clarity (UI-01), show terminal immediately when session exists (UI-03, UI-04), and eliminate redundant initialization button (UI-05).
Output: Output Project page with proper breadcrumbs, session-aware terminal rendering, and single initialization path via terminal WebSocket.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/30-ui-polish/30-RESEARCH.md

# Main file to modify
@frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx

# Context providers already in use
@frontend/src/contexts/TerminalSessionContext.tsx
@frontend/src/components/terminal/InteractiveTerminal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update breadcrumbs to show Output Project hierarchy</name>
  <files>frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx</files>
  <action>
    Replace the inline breadcrumb in the left sidebar (lines 200-210) with a proper breadcrumb structure.

    Current code shows only 2 levels in a small area:
    ```tsx
    <div className="flex items-center gap-1 text-xs text-zinc-500">
      <Link href={`/project/${kbId}`} className="hover:text-zinc-300">
        Knowledge Base
      </Link>
      <span>/</span>
      <Link href={`/project/${kbId}/output-projects`} className="hover:text-zinc-300">
        Output Projects
      </Link>
    </div>
    ```

    Replace with 3-level breadcrumb that includes current Output Project name:
    ```tsx
    <div className="flex items-center gap-1 text-xs text-zinc-500 flex-wrap">
      <Link href="/dashboard" className="hover:text-zinc-300">
        KB
      </Link>
      <span>/</span>
      <Link href={`/project/${kbId}`} className="hover:text-zinc-300 truncate max-w-[80px]" title="Knowledge Base">
        Projeto
      </Link>
      <span>/</span>
      <Link href={`/project/${kbId}/output-projects`} className="hover:text-zinc-300">
        Output
      </Link>
      <span>/</span>
      <span className="text-zinc-300 truncate max-w-[100px]" title={project.name}>
        {project.name}
      </span>
    </div>
    ```

    IMPORTANT: Use truncation (max-w-[100px] truncate) to handle long names.
    IMPORTANT: Last item is span (not Link) - current page.
  </action>
  <verify>
    TypeScript compiles: `cd frontend && npm run type-check`
    Visual: Breadcrumb shows KB > Projeto > Output > {project name}
  </verify>
  <done>
    Breadcrumb shows 4-level hierarchy: KB > Projeto > Output > Current Project
    Long names are truncated with title tooltip
    Current page (project name) is not a link
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove redundant INICIAR button from milestone details</name>
  <files>frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx</files>
  <action>
    Remove the INICIAR button block (lines 276-286):

    DELETE this block entirely:
    ```tsx
    {selectedMilestone?.status === "pending" && (
      <Button
        onClick={handleInitializeMilestone}
        disabled={isMilestoneInitializing}
        size="sm"
        className="gap-2"
      >
        <Play className="w-3 h-3" />
        {isMilestoneInitializing ? "Iniciando..." : "Iniciar"}
      </Button>
    )}
    ```

    WHY: Terminal WebSocket handler already creates session for pending milestones automatically.
    The button is redundant - when user connects to terminal, backend auto-initializes.

    ALSO: Remove the handleInitializeMilestone callback (lines 165-170) since it's no longer used:
    ```tsx
    const handleInitializeMilestone = useCallback(() => {
      if (selectedMilestone) {
        terminalRef.current?.writeln(`\x1b[36m[iniciando milestone: ${selectedMilestone.element_name}]\x1b[0m`);
        initializeMilestone();
      }
    }, [initializeMilestone, selectedMilestone]);
    ```

    ALSO: Remove imports if no longer needed:
    - Play icon might still be needed for project initialization button (line 226)
    - Keep Play if still used elsewhere
  </action>
  <verify>
    TypeScript compiles: `cd frontend && npm run type-check`
    No INICIAR button visible in milestone details header
    Terminal still initializes session when connecting to pending milestone
  </verify>
  <done>
    INICIAR button removed from milestone details
    handleInitializeMilestone callback removed
    Single initialization path: terminal WebSocket connection
  </done>
</task>

<task type="auto">
  <name>Task 3: Show InteractiveTerminal when session exists (no milestone selected)</name>
  <files>frontend/src/app/project/[id]/output-projects/[projectId]/page.tsx</files>
  <action>
    Import useTerminalSessionOptional (already imported via @/contexts):
    ```tsx
    import { useTerminalSessionOptional } from "@/contexts";
    ```

    Add session context check near the top of the component:
    ```tsx
    // Terminal session context for persistence
    const terminalSession = useTerminalSessionOptional();
    const hasActiveSession = terminalSession?.lastConnectionState === "connected" ||
                             terminalSession?.shouldReconnect;
    ```

    Modify terminal rendering logic (around lines 386-396):

    CURRENT:
    ```tsx
    {selectedMilestoneId ? (
      <InteractiveTerminal
        milestoneId={selectedMilestoneId}
        className="h-full"
        onError={(msg) => console.error("Terminal error:", msg)}
      />
    ) : (
      <Terminal ref={terminalRef} className="h-full" />
    )}
    ```

    NEW:
    ```tsx
    {/* Show InteractiveTerminal when:
        1. A milestone is selected, OR
        2. There's an active/resumable session (UI-03, UI-04) */}
    {(selectedMilestoneId || hasActiveSession) ? (
      <InteractiveTerminal
        milestoneId={selectedMilestoneId || terminalSession?.activeMilestoneId || ""}
        className="h-full"
        onError={(msg) => console.error("Terminal error:", msg)}
      />
    ) : (
      <Terminal ref={terminalRef} className="h-full" />
    )}
    ```

    ALSO: Update milestone selection to sync with context:
    ```tsx
    // After const [selectedMilestoneId, setSelectedMilestoneId] = useState<string | null>(null);
    // Add effect to sync milestone selection with terminal session context
    useEffect(() => {
      if (terminalSession && selectedMilestoneId) {
        terminalSession.setActiveMilestone(selectedMilestoneId);
      }
    }, [selectedMilestoneId, terminalSession]);
    ```

    WHY:
    - UI-03: Initialize Project page shows terminal immediately when session exists
    - UI-04: Page refresh shows terminal with active session (WebSocket reconnects)
  </action>
  <verify>
    TypeScript compiles: `cd frontend && npm run type-check`
    Navigate to Output Project without selecting milestone - if session exists, InteractiveTerminal shows
    Page refresh with active session shows InteractiveTerminal (not blank Terminal)
  </verify>
  <done>
    InteractiveTerminal shown when session exists, even without milestone selected
    Milestone selection syncs with TerminalSessionContext
    Page refresh preserves terminal session display
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `cd frontend && npm run type-check`
2. Breadcrumb shows KB > Projeto > Output > {project name} hierarchy
3. No INICIAR button in milestone details header
4. Select milestone, terminal connects and initializes automatically
5. Navigate away and back - terminal reconnects (session preserved)
6. Page refresh on milestone page - InteractiveTerminal shows, not blank Terminal
</verification>

<success_criteria>
- Breadcrumb shows 4-level hierarchy with proper truncation
- INICIAR button removed from milestone details
- handleInitializeMilestone callback removed
- InteractiveTerminal renders when hasActiveSession is true
- Milestone selection synced with TerminalSessionContext
- Page refresh behavior: terminal reconnects via WebSocket
</success_criteria>

<output>
After completion, create `.planning/phases/30-ui-polish/30-02-SUMMARY.md`
</output>
