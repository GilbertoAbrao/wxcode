---
phase: 10-product-model-api
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/wxcode/models/product.py
  - src/wxcode/models/__init__.py
  - src/wxcode/database.py
autonomous: true

must_haves:
  truths:
    - "Product model exists with all required fields"
    - "ProductType enum has all 4 types"
    - "ProductStatus enum includes unavailable status"
    - "Product model is registered in Beanie"
  artifacts:
    - path: "src/wxcode/models/product.py"
      provides: "Product Beanie Document with enums"
      exports: ["Product", "ProductType", "ProductStatus"]
    - path: "src/wxcode/models/__init__.py"
      provides: "Module exports"
      contains: "Product"
    - path: "src/wxcode/database.py"
      provides: "Beanie model registration"
      contains: "Product"
  key_links:
    - from: "src/wxcode/models/product.py"
      to: "src/wxcode/models/project.py"
      via: "Link[Project] import"
      pattern: "from wxcode.models.project import Project"
    - from: "src/wxcode/database.py"
      to: "src/wxcode/models/product.py"
      via: "Product import for init_beanie"
      pattern: "from wxcode.models.product import Product"
---

<objective>
Create Product Beanie Document model with ProductType and ProductStatus enums, and register it in the database initialization.

Purpose: Products are first-class entities that represent outputs from imported projects (conversion, api, mcp, agents). This model enables tracking product lifecycle and status.

Output: Product model ready for use by API endpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-product-model-api/10-RESEARCH.md

# Reference patterns
@src/wxcode/models/conversion.py
@src/wxcode/models/project.py
@src/wxcode/models/__init__.py
@src/wxcode/database.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Product model with enums</name>
  <files>src/wxcode/models/product.py</files>
  <action>
Create new file `src/wxcode/models/product.py` following the conversion.py pattern:

1. Create `ProductType(str, Enum)` with values:
   - CONVERSION = "conversion"
   - API = "api"
   - MCP = "mcp"
   - AGENTS = "agents"

2. Create `ProductStatus(str, Enum)` with values:
   - PENDING = "pending"
   - IN_PROGRESS = "in_progress"
   - PAUSED = "paused"
   - COMPLETED = "completed"
   - FAILED = "failed"
   - UNAVAILABLE = "unavailable"

3. Create `Product(Document)` class with fields:
   - project_id: Link[Project] (required, from wxcode.models.project)
   - product_type: ProductType (required)
   - workspace_path: str (required)
   - status: ProductStatus (default=PENDING)
   - session_id: Optional[str] (default=None)
   - output_directory: Optional[str] (default=None)
   - created_at: datetime (default_factory=datetime.utcnow)
   - updated_at: datetime (default_factory=datetime.utcnow)
   - started_at: Optional[datetime] (default=None)
   - completed_at: Optional[datetime] (default=None)

4. Add Settings class:
   - name = "products"
   - use_state_management = True
   - indexes on: project_id, product_type, status, (project_id + product_type)

5. Add __str__ method returning `Product(type, status=status)`

Use Portuguese docstrings following codebase convention.
  </action>
  <verify>
python -c "from wxcode.models.product import Product, ProductType, ProductStatus; print('OK')"
  </verify>
  <done>
Product model exists with all fields (project_id, product_type, workspace_path, status, session_id, timestamps) and both enums (ProductType with 4 values, ProductStatus with 6 values including unavailable)
  </done>
</task>

<task type="auto">
  <name>Task 2: Register Product model in exports and database</name>
  <files>src/wxcode/models/__init__.py, src/wxcode/database.py</files>
  <action>
1. Update `src/wxcode/models/__init__.py`:
   - Add import: `from wxcode.models.product import Product, ProductType, ProductStatus`
   - Add to __all__ list: "Product", "ProductType", "ProductStatus" (in new # Product section)

2. Update `src/wxcode/database.py`:
   - Add import: `from wxcode.models.product import Product`
   - Add Product to document_models list in init_beanie call
  </action>
  <verify>
python -c "from wxcode.models import Product, ProductType, ProductStatus; print('Exports OK')" && \
python -c "import ast; code = open('src/wxcode/database.py').read(); tree = ast.parse(code); print('Syntax OK')"
  </verify>
  <done>
Product, ProductType, ProductStatus exported from models/__init__.py and Product registered in database.py document_models list
  </done>
</task>

</tasks>

<verification>
```bash
# Verify model imports work
cd /Users/gilberto/projetos/wxk/wxcode
python -c "
from wxcode.models import Product, ProductType, ProductStatus
print(f'ProductType values: {[t.value for t in ProductType]}')
print(f'ProductStatus values: {[s.value for s in ProductStatus]}')
print('Model fields:', list(Product.model_fields.keys()))
"

# Verify database registration (syntax check)
python -c "
import ast
with open('src/wxcode/database.py') as f:
    tree = ast.parse(f.read())
print('database.py syntax OK')
"
```
</verification>

<success_criteria>
- Product model file exists at `src/wxcode/models/product.py`
- ProductType enum has 4 values: conversion, api, mcp, agents
- ProductStatus enum has 6 values including unavailable
- Product Document has all required fields: project_id, product_type, workspace_path, status, session_id
- Product exported from `models/__init__.py`
- Product registered in `database.py` document_models
- All imports resolve without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-product-model-api/10-01-SUMMARY.md`
</output>
