---
phase: 14-data-models
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/wxcode/models/stack.py
  - src/wxcode/models/output_project.py
  - src/wxcode/models/milestone.py
autonomous: true

must_haves:
  truths:
    - "Stack model exists with all characteristics from R2"
    - "OutputProject model exists with KB/Stack/Configuration references"
    - "Milestone model exists with OutputProject/Element references"
    - "All models follow Beanie Document patterns"
  artifacts:
    - path: "src/wxcode/models/stack.py"
      provides: "Stack model for target technology definition"
      contains: "class Stack(Document)"
    - path: "src/wxcode/models/output_project.py"
      provides: "OutputProject model for conversion target"
      contains: "class OutputProject(Document)"
    - path: "src/wxcode/models/milestone.py"
      provides: "Milestone model for element conversion tracking"
      contains: "class Milestone(Document)"
  key_links:
    - from: "src/wxcode/models/stack.py"
      to: "beanie.Document"
      via: "class inheritance"
      pattern: "class Stack\\(Document\\)"
    - from: "src/wxcode/models/output_project.py"
      to: "beanie.PydanticObjectId"
      via: "kb_id reference"
      pattern: "kb_id: PydanticObjectId"
    - from: "src/wxcode/models/milestone.py"
      to: "beanie.PydanticObjectId"
      via: "output_project_id reference"
      pattern: "output_project_id: PydanticObjectId"
---

<objective>
Create the three core data models for v4 multi-stack support: Stack, OutputProject, and Milestone.

Purpose: These models form the foundation for the v4 conceptual restructure. Stack defines target technology characteristics, OutputProject represents conversion projects, and Milestone tracks individual element conversions.

Output: Three new Beanie Document models following existing project patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/milestones/v4/REQUIREMENTS.md
@.planning/milestones/v4/ROADMAP.md
@.planning/phases/14-data-models/14-RESEARCH.md

# Existing model patterns
@src/wxcode/models/product.py
@src/wxcode/models/conversion_history.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Stack Model</name>
  <files>src/wxcode/models/stack.py</files>
  <action>
Create Stack model following existing Beanie Document patterns.

Fields (from R2):
- stack_id: str (unique identifier like "fastapi-htmx")
- name: str (display name like "FastAPI + HTMX")
- group: str ("server-rendered" | "spa" | "fullstack")
- language: str ("python" | "typescript" | "php" | "ruby")
- framework: str ("fastapi" | "django" | "laravel" | etc.)
- orm: str ("sqlalchemy" | "django-orm" | "eloquent" | etc.)
- orm_pattern: str ("active-record" | "data-mapper" | "repository")
- template_engine: str ("jinja2" | "blade" | "erb" | "jsx" | etc.)
- file_structure: dict[str, str] (path templates)
- naming_conventions: dict[str, str] (naming rules)
- type_mappings: dict[str, str] (HyperFile to target types)
- imports_template: str (common imports)
- model_template: str (example model structure)

Pattern requirements:
- Use `class Stack(Document)` (inherit from beanie.Document)
- Add Settings class with `name = "stacks"` and `use_state_management = True`
- Add indexes for stack_id, group, language
- Use Field() with descriptions for all fields
- Use dict[str, str] (NOT dict) for typed dict fields
- Use default_factory=dict for dict fields

Note: Stack uses string stack_id as business key (NOT ObjectId). MongoDB still generates _id automatically.
  </action>
  <verify>
python -c "from wxcode.models.stack import Stack; print(Stack.model_fields.keys())"
  </verify>
  <done>
Stack model exists with all 13 fields from R2, proper Beanie Settings class, and indexes on stack_id, group, language.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create OutputProject Model</name>
  <files>src/wxcode/models/output_project.py</files>
  <action>
Create OutputProject model following existing Beanie Document patterns.

Fields (from R5):
- kb_id: PydanticObjectId (reference to Knowledge Base/Project)
- name: str (user-defined project name)
- stack_id: str (reference to Stack.stack_id)
- configuration_id: Optional[str] (selected WinDev Configuration ID, can be None)
- workspace_path: str (path in ~/.wxcode/workspaces/)
- status: OutputProjectStatus enum ("created" | "initialized" | "active")
- created_at: datetime (default_factory=datetime.utcnow)
- updated_at: datetime (default_factory=datetime.utcnow)

Create OutputProjectStatus enum:
- Inherit from (str, Enum) for JSON serialization
- Values: CREATED, INITIALIZED, ACTIVE

Pattern requirements:
- Use PydanticObjectId for kb_id (NOT Link) - avoids extra queries
- Use str for stack_id (references Stack.stack_id)
- Use Optional[str] for configuration_id (can be None initially)
- Add Settings class with `name = "output_projects"` and `use_state_management = True`
- Add indexes for kb_id, stack_id, status, and compound indexes
  </action>
  <verify>
python -c "from wxcode.models.output_project import OutputProject, OutputProjectStatus; print(OutputProject.model_fields.keys()); print([s.value for s in OutputProjectStatus])"
  </verify>
  <done>
OutputProject model exists with all 8 fields from R5, OutputProjectStatus enum, proper Settings class, and indexes.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Milestone Model</name>
  <files>src/wxcode/models/milestone.py</files>
  <action>
Create Milestone model following existing Beanie Document patterns.

Fields (from R8):
- output_project_id: PydanticObjectId (parent output project)
- element_id: PydanticObjectId (KB element to convert)
- element_name: str (denormalized for display)
- status: MilestoneStatus enum ("pending" | "in_progress" | "completed" | "failed")
- created_at: datetime (default_factory=datetime.utcnow)
- completed_at: Optional[datetime] (None until completed)

Create MilestoneStatus enum:
- Inherit from (str, Enum) for JSON serialization
- Values: PENDING, IN_PROGRESS, COMPLETED, FAILED

Pattern requirements:
- Use PydanticObjectId for both output_project_id and element_id (NOT Link)
- Include element_name denormalized to avoid extra queries for display
- Use Optional[datetime] for completed_at with default=None
- Add Settings class with `name = "milestones"` and `use_state_management = True`
- Add indexes for output_project_id, element_id, status, and compound indexes
  </action>
  <verify>
python -c "from wxcode.models.milestone import Milestone, MilestoneStatus; print(Milestone.model_fields.keys()); print([s.value for s in MilestoneStatus])"
  </verify>
  <done>
Milestone model exists with all 6 fields from R8, MilestoneStatus enum with 4 values, proper Settings class, and indexes.
  </done>
</task>

</tasks>

<verification>
All three models importable:
```bash
python -c "
from wxcode.models.stack import Stack
from wxcode.models.output_project import OutputProject, OutputProjectStatus
from wxcode.models.milestone import Milestone, MilestoneStatus
print('Stack fields:', len(Stack.model_fields))
print('OutputProject fields:', len(OutputProject.model_fields))
print('Milestone fields:', len(Milestone.model_fields))
print('All models created successfully')
"
```
</verification>

<success_criteria>
- Stack model has 13 fields matching R2 specification
- OutputProject model has 8 fields matching R5 specification
- Milestone model has 6 fields matching R8 specification
- All models inherit from beanie.Document
- All models have Settings class with use_state_management = True
- All status fields use (str, Enum) pattern
- All reference fields use PydanticObjectId (not Link)
</success_criteria>

<output>
After completion, create `.planning/phases/14-data-models/14-01-SUMMARY.md`
</output>
